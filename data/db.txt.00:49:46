[ DB LOG -- 00:49:46 ]

[ Query Time ]

Count: 130  Time=3.15s (408s)  Lock=0.00s (0s)  Rows=14.3 (1859), isucon[isucon]@localhost
  SELECT name, data FROM image WHERE name = 'S'

Count: 31317  Time=0.00s (39s)  Lock=0.00s (0s)  Rows=0.8 (24431), 2users@localhost
  #

Count: 2157  Time=0.02s (39s)  Lock=0.00s (0s)  Rows=1.0 (2157), isucon[isucon]@localhost
  SELECT COUNT(*) as cnt FROM message WHERE channel_id = N

Count: 9662  Time=0.00s (28s)  Lock=0.00s (4s)  Rows=1.0 (9662), isucon[isucon]@localhost
  SELECT name, display_name, avatar_icon FROM user WHERE id = N

Count: 76  Time=0.22s (16s)  Lock=0.00s (0s)  Rows=6.0 (458), isucon[isucon]@localhost
  SELECT * FROM message WHERE channel_id = N ORDER BY id DESC LIMIT N OFFSET N

Count: 120  Time=0.10s (11s)  Lock=0.00s (0s)  Rows=76.7 (9204), isucon[isucon]@localhost
  SELECT * FROM message WHERE id > N AND channel_id = N ORDER BY id DESC LIMIT N

Count: 35  Time=0.10s (3s)  Lock=0.23s (8s)  Rows=0.0 (0), isucon[isucon]@localhost
  INSERT INTO image (name, data) VALUES ('S', 'S')

Count: 246  Time=0.01s (1s)  Lock=0.00s (0s)  Rows=100.0 (24600), isucon[isucon]@localhost
  SELECT * FROM channel ORDER BY id

Count: 484  Time=0.00s (1s)  Lock=0.00s (0s)  Rows=1.0 (474), isucon[isucon]@localhost
  SELECT * FROM user WHERE name = 'S'

Count: 2100  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (19), isucon[isucon]@localhost
  SELECT * FROM haveread WHERE user_id = N AND channel_id = N

Count: 96  Time=0.01s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  INSERT INTO haveread (user_id, channel_id, message_id, updated_at, created_at) VALUES (N, N, N, NOW(), NOW()) ON DUPLICATE KEY UPDATE message_id = N, updated_at = NOW()

Count: 471  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=1.0 (471), isucon[isucon]@localhost
  SELECT * FROM user WHERE id = N

Count: 35  Time=0.02s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  UPDATE user SET avatar_icon = 'S' WHERE id = N

Count: 43  Time=0.01s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  INSERT INTO user (name, salt, password, display_name, avatar_icon, created_at) VALUES ('S', 'S', 'S', 'S', 'S', NOW())

Count: 35  Time=0.01s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  UPDATE user SET display_name = 'S' WHERE id = N

Count: 46  Time=0.01s (0s)  Lock=0.00s (0s)  Rows=1.0 (46), isucon[isucon]@localhost
  SELECT @@max_allowed_packet

Count: 180  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  INSERT INTO channel (name, description, updated_at, created_at) VALUES ('S', 'S', NOW(), NOW())

Count: 46  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  SET NAMES utf8mb4

Count: 2  Time=0.02s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  DELETE FROM image WHERE id > N

Count: 21  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=100.0 (2100), isucon[isucon]@localhost
  SELECT id FROM channel

Count: 2  Time=0.02s (0s)  Lock=0.03s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  DELETE FROM user WHERE id > N

Count: 19  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=1.0 (19), isucon[isucon]@localhost
  SELECT COUNT(*) as cnt FROM message WHERE channel_id = N AND N < id

Count: 2  Time=0.01s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  DELETE FROM channel WHERE id > N

Count: 2  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  DELETE FROM haveread

Count: 2  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  INSERT INTO message (channel_id, user_id, content, created_at) VALUES (N, N, 'S', NOW())

Count: 2  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  DELETE FROM message WHERE id > N

Count: 15645  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), 0users@0hosts
  administrator command: Prepare

Count: 26  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), 0users@0hosts
  administrator command: Quit

Count: 1  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), 0users@0hosts
  administrator command: Ping

Count: 15645  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), 0users@0hosts
  administrator command: Close stmt

[ TOP Query Count ]

Count: 31317  Time=0.00s (39s)  Lock=0.00s (0s)  Rows=0.8 (24431), 2users@localhost
  #

Count: 15645  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), 0users@0hosts
  administrator command: Prepare

Count: 15645  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), 0users@0hosts
  administrator command: Close stmt

Count: 9662  Time=0.00s (28s)  Lock=0.00s (4s)  Rows=1.0 (9662), isucon[isucon]@localhost
  SELECT name, display_name, avatar_icon FROM user WHERE id = N

Count: 2157  Time=0.02s (39s)  Lock=0.00s (0s)  Rows=1.0 (2157), isucon[isucon]@localhost
  SELECT COUNT(*) as cnt FROM message WHERE channel_id = N

Count: 2100  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (19), isucon[isucon]@localhost
  SELECT * FROM haveread WHERE user_id = N AND channel_id = N

Count: 484  Time=0.00s (1s)  Lock=0.00s (0s)  Rows=1.0 (474), isucon[isucon]@localhost
  SELECT * FROM user WHERE name = 'S'



[ TOP Query AVG ]

Count: 130  Time=3.15s (408s)  Lock=0.00s (0s)  Rows=14.3 (1859), isucon[isucon]@localhost
  SELECT name, data FROM image WHERE name = 'S'

Count: 76  Time=0.22s (16s)  Lock=0.00s (0s)  Rows=6.0 (458), isucon[isucon]@localhost
  SELECT * FROM message WHERE channel_id = N ORDER BY id DESC LIMIT N OFFSET N

Count: 120  Time=0.10s (11s)  Lock=0.00s (0s)  Rows=76.7 (9204), isucon[isucon]@localhost
  SELECT * FROM message WHERE id > N AND channel_id = N ORDER BY id DESC LIMIT N

Count: 35  Time=0.10s (3s)  Lock=0.23s (8s)  Rows=0.0 (0), isucon[isucon]@localhost
  INSERT INTO image (name, data) VALUES ('S', 'S')

Count: 35  Time=0.02s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  UPDATE user SET avatar_icon = 'S' WHERE id = N

Count: 2157  Time=0.02s (39s)  Lock=0.00s (0s)  Rows=1.0 (2157), isucon[isucon]@localhost
  SELECT COUNT(*) as cnt FROM message WHERE channel_id = N

Count: 2  Time=0.02s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), isucon[isucon]@localhost
  DELETE FROM image WHERE id > N



